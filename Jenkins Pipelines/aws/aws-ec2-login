pipeline {
    agent any

    environment {
        //Define the AWS environment here
        EC2_INSTANCE_IP = '54.152.102.140'
        SSH_CREDENTIALS_ID = 'jenkins-aws'
    }

    stages {
        stage('Run a command on EC2') {
            steps {
                script {
                    //SSH into a EC2 EC2_INSTANCE
                    sshagent([SSH_CREDENTIALS_ID]) {
                        sh '''
                            #!/bin/bash
                            echo "Starting SSH connection..."
                            ssh -o StrictHostKeyChecking=no ubuntu@${EC2_INSTANCE_IP} << 'EOF'
                                echo "Hey I am $(whoami) is successfully login to $(hostname)"
                                pwd
                                echo "The memory space of this instance"
                                free -m
                                echo "The disk space is:"
                                df -h
                                echo "All commands executed successfully, thanks"
                            'EOF'
                        '''
                    }
                }
            }
        }
    }
}

