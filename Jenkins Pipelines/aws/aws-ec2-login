pipeline {
    agent any

    environment {
        //Define the AWS environment here
        EC2_INSTANCE_IP = '54.152.102.140'
        SSH_CREDENTIALS_ID = 'jenkins-aws'
    }

    stages {
        stage('Run a command on EC2') {
            steps {
                script {
                    //SSH into a EC2 EC2_INSTANCE
                    sshagent([SSH_CREDENTIALS_ID]) {
                        sh '''
                            #!/bin/bash
                            echo "Starting SSH connection..."
                            echo "EC2 IP: ${EC2_INSTANCE_IP}"
                            set -x  # Print each command before executing
                            ssh -o StrictHostKeyChecking=no ubuntu@${EC2_INSTANCE_IP} 'echo Hello from EC2'
                            set +x  # Stop printing commands
                        '''
                    }
                }
            }
        }
    }
}

